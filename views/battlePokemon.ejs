<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>CodeSandbox Vue</title>
    <!-- Carrega a biblioteca Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <!-- Importa o arquivo de estilo battlePokemon.css -->
    <link rel="stylesheet" href="/css/battlePokemon.css">
</head>

<body>

<div  id="fullframe">
    <h1>Derrote Todos os 151 pokemons</h1>
    <div>
        <div v-if="!victory">

            <div class="user-poke" v-if="pokemonSelecionado">
                <!-- Exibe a imagem do pokémon do usuário, com animações baseadas nas classes CSS 'playerShake' e 'playerAttack' -->
                <img class="centerPokemonPlayer" v-bind:src="userPokemon" v-bind:class="{'playerShake': playerShake, 'playerAttack': playerAttack}" />
            </div>
            
            <div class="user-hp" v-if="pokemonSelecionado">
                <!-- Exibe a barra de vida (HP) do pokémon do usuário -->
                <span>{{ bottomPoke }}</span>
                <p>&nbsp;HP:&nbsp;<span class="hp-bar-fill" v-bind:style="userHpObj"></span></p>
            </div>
            
            <div class="opponent-poke">
                <!-- Exibe a imagem do pokémon oponente, com animações baseadas nas classes CSS 'opponentShake' e 'oppoAttack' -->
                <img class="centerPokemon" v-bind:src="oppoPokemon" v-bind:class="{'opponentShake': opponentShake, 'oppoAttack': oppoAttack}" />
            </div>
            
            <div class="opponent-hp">
                <!-- Exibe a barra de vida (HP) do pokémon oponente -->
                <span>{{ bottomPokeEnemy }}</span>

                <p>&nbsp;HP:&nbsp;<span class="hp-bar-fill" v-bind:style="oppoHpObj"></span></p>
            </div> 
            
            <div class="bottom-left">
                <!-- Exibe o texto no canto inferior esquerdo da tela -->
                <div class="bottom-left-text">
                    <p v-html="bottomText" class="centerOption tooltip">{{ bottomText }}</p>
                    <div v-if="!pokemonSelecionado" class="warning">
                        <p>Please choose a Pokémon before starting the battle.</p>
                    </div>
                    <ul v-show="mostrarPokemons" style="display: flex; list-style: none;" v-show="mostrarPokemons && showPokemonList">
                        <% user.team.forEach((pokemon, id) => { %>
                            
                            <li class="pokemonTeam-li "><a v-on:click.prevent="trocarPokemon(<%= id%>)"><%= pokemon.name %></a></li>
                        <%})%>
                    </ul>

        
                </div>
            </div>
            
            <div class="bottom-right">
                <div v-show="showbottomright">
                    <!-- Exibe as opções disponíveis na batalha -->
                    <a v-if="backStatus" v-on:click.prevent="backOption" href="" class="centerbackOption">BACK</a>
                    <div class="bottom-right-1">
                        <!-- Opção de ataque 1 - mostra um tooltip se tooltipStatus for verdadeiro -->
                        <a v-on:click.prevent="fightOptionStatus ? fightOption() : userAttackingOption(1)" href="" class="centerOption tooltip"><span v-if="tooltipStatus" class="tooltiptext">A reckless charge attack that also hurts the user.</span>{{ option1 }}</a>
                    </div>
        
                    <!-- Restantes opções de ataque -->
                    <div class="bottom-right-2">
                        <a v-on:click.prevent="fightOptionStatus ? itemOption() : userAttackingOption(2)" href="" class="centerOption tooltip"><span v-if="tooltipStatus" class="tooltiptext">Strikes the foe with slender, whiplike vines.</span>{{ option2 }}</a>
                    </div>
        
                    <div class="bottom-right-3">
                        <a v-on:click.prevent="fightOptionStatus ? pokemonOption() : userAttackingOption(3)" href="" class="centerOption tooltip"><span v-if="tooltipStatus" class="tooltiptext">Solar Beam will absorb light on the first turn. On the second turn, Solar Beam deals damage.</span>{{ option3 }}</a>
                    </div>
        
                    <div class="bottom-right-4">
                        <a v-on:click.prevent="fightOptionStatus ? runOption() : userAttackingOption(4)" href="" class="centerOption tooltip"><span v-if="tooltipStatus" class="tooltiptext">Cuts the enemy with leaves. High critical-hit ratio.</span>{{ option4 }}</a>
                    </div>
                </div>    
            </div>

        </div>
        <div v-if="victory">
            <h1>You win!</h1>
            <button v-on:click.prevent="restart()">Restart</button>

        </div>
    </div>
    <a href="/dashboard">Voltar</a>

</div>


 

  <script>
    function selectRandomEnemyPokemon() {
    const randomIndex = Math.floor(Math.random() * teamEnemy.length);
    return teamEnemy.splice(randomIndex, 1)[0];
}
    // Inicializa a variável teamPokemons com o time de pokémons do usuário, convertido para JSON
    const teamPokemons = <%- JSON.stringify(user.team) %>;
    const teamEnemy = <%- JSON.stringify(enemyTeam) %>;
    var numberPokemonEnemy = 0
    // Cria uma nova instância do Vue
    var pokemonApp = new Vue({
      el: '#fullframe', // Monta a instância na div com id "fullframe"
      data: {
          // Dados do jogo
          victory: false,
          pokemonSelecionado: null,
          mostrarPokemons: false,
          userHP: 300,
          oppoHP: 250,
          userPokemon: teamPokemons[0].images.imageAnimatedBack,
          oppoPokemon: teamEnemy[0].gifImage,
          bottomPoke: teamPokemons[0].name,
          bottomPokeEnemy: `${teamEnemy[0].id}. ${teamEnemy[0].name}` ,
          bottomText: "",
          option1: "Fight",
          topPoke: "Absol",
          option2: "Item",
          option3: "Change Pokemon",
          option4: "Run",
          backStatus: false,
          tooltipStatus: false,
          timers: null,
          fightOptionStatus: true,
          option1DMG: 70,
          option2DMG: 30,
          option3DMG: 200,
          option4DMG: 100,
          userHpObj: { width: '100%' },
          oppoHpObj: { width: '100%' },
          playerShake: false,
          opponentShake: false,
          playerAttack: false,
          oppoAttack: false,
          currentTurn: "player",
          showbottomright: true,
          pokemons: teamPokemons,
          showPokemonList:true,
      },
      methods: {
      // Função para trocar o Pokémon atual pelo selecionado
      trocarPokemon: function (indicePokemon) {
        // Obtenha os dados do Pokémon selecionado
        const pokemonSelecionado = this.pokemons[indicePokemon];

        // Atualize a propriedade 'pokemonSelecionado' com os dados do Pokémon escolhido
        this.pokemonSelecionado = pokemonSelecionado;

        // Atualize o usuário com o Pokémon selecionado
        this.userPokemon = this.pokemonSelecionado.images.imageAnimatedBack;
        this.bottomPoke = this.pokemonSelecionado.name;
        this.userHP = 300; // Reinicie o HP do usuário ao trocar de Pokémon
        this.userHpObj.width = '160px'; // Reinicie a largura da barra de HP
        this.currentTurn = 'player'; // Reinicie o turno atual para o turno do jogador

        // Atualize as habilidades do usuário de acordo com o Pokémon selecionado
        this.option1 = pokemonSelecionado.abilities[0];
        this.option2 = pokemonSelecionado.abilities[1];
        this.option3 = pokemonSelecionado.abilities[2];
        this.option4 = pokemonSelecionado.abilities[3];
        
        // Oculte as opções do canto inferior direito e redefina-as para os valores padrão
        this.showbottomright = true;
        this.reinitialize();
        this.bottomText = ''

    },

    // Função para exibir a lista de Pokémon disponíveis para troca
    exibirListaDePokemon: function () {

        let lista = '<ul>';
        for (let i = 0; i < this.pokemons.length; i++) {
            lista += `<li><a v-on:click.prevent="trocarPokemon(${i})">${this.pokemons[i].name}</a></li>`;
        }
        lista += '</ul>';
        this.mostrarPokemons = true;
        this.bottomText = '';
    },
          // Função que muda as opções para ataques
          fightOption: function (){
            this.option1 = this.pokemonSelecionado.abilities[0];
          this.option2 = this.pokemonSelecionado.abilities[1];
          this.option3 = this.pokemonSelecionado.abilities[2];
          this.option4 = this.pokemonSelecionado.abilities[3];

          this.backStatus = true;
          this.tooltipStatus = true;
          this.fightOptionStatus = false;
          },
          // Função para mostrar que não há itens restantes
          itemOption: function (){
              this.bottomText="No item left!";
              var vm = this;
              clearTimeout(this.timers);
              this.timers = setTimeout(function(){
                  vm.bottomText="";
              },1500);
          },

          pokemonOption: function () {
            this.exibirListaDePokemon();

          },
          // Função para mostrar que não é possível fugir
          runOption: function (){
              this.bottomText="Cannot Run!";
              var vm = this;
              clearTimeout(this.timers);
              this.timers = setTimeout(function(){
                  vm.bottomText="";
              },1500);
          },
          // Função para voltar às opções iniciais de luta
          backOption: function (){
              this.option1="Fight";
              this.option2="Item";
              this.option3="Change Pokemon";
              this.option4="Run";
              this.backStatus=false;
              this.tooltipStatus=false;
              this.fightOptionStatus=true;
          },
          // Função para executar o ataque do usuário
          userAttackingOption: function (moveId){
            this.mostrarPokemons = false;

              // Mapeia a lógica para cada opção de ataque (1 a 4)
              if (moveId == 1){
                  // Ataque 1: Take Down
                  
                  this.showbottomright=false;
                  this.bottomText=`${this.bottomPoke} used ${this.pokemonSelecionado.abilities[0]}`;
                  this.oppoHP-=this.option1DMG;
                  // 160px health é considerado 100%
                  var newWidth = (this.oppoHP/250)*160;
                  this.playerAttack=true;
                  this.opponentShake=true;
                  setTimeout(()=>{
                      this.playerAttack=false;
                      this.opponentShake=false;
                  },500);
                  this.oppoHpObj.width= newWidth + "px";
                  // Verifica se o oponente desmaiou
                  if (this.oppoHP < 0){
                    
                      this.nextEnemy();

                  } else {
                    setTimeout(()=> {
                          this.showbottomright=true;
                          this.bottomText="";
                          this.currentTurn="opponent";
                          this.absolAttack();
                      },1000);                           
                  }
              }else if(moveId == 2){
                  // Ataque 2: Vine Whip
                  this.showbottomright=false;
                  this.bottomText=`${this.bottomPoke} used ${this.pokemonSelecionado.abilities[1]}`;
                  this.oppoHP-=this.option2DMG;
                  // 160px health é considerado 100%
                  var newWidth = (this.oppoHP/250)*160;
                  this.playerAttack=true;
                  this.opponentShake=true;
                  setTimeout(()=>{
                      this.playerAttack=false;
                      this.opponentShake=false;
                  },1000);
                  this.oppoHpObj.width= newWidth + "px";
                  // Verifica se o oponente desmaiou
                  if (this.oppoHP < 0){
                      this.nextEnemy();
                  } else {
                        setTimeout(()=> {
                          this.showbottomright=true;
                          this.bottomText="";
                          this.currentTurn="opponent";
                          this.absolAttack();
                      },1000);                            
                  }
              }else if(moveId == 3){
                  // Ataque 3: Solar Beam
                  this.showbottomright=false;
                  this.bottomText=`${this.bottomPoke} used ${this.pokemonSelecionado.abilities[2]}`;
                  this.oppoHP-=this.option3DMG;
                  // 160px health é considerado 100%
                  var newWidth = (this.oppoHP/250)*160;
                  this.playerAttack=true;
                  this.opponentShake=true;
                  setTimeout(()=>{
                      this.playerAttack=false;
                      this.opponentShake=false;
                  },1000);
                  this.oppoHpObj.width= newWidth + "px";
                  // Verifica se o oponente desmaiou
                  if (this.oppoHP < 0){
                      this.nextEnemy();
                  } else {
                      setTimeout(()=> {
                          this.showbottomright=true;
                          this.bottomText="";
                          this.currentTurn="opponent";
                          this.absolAttack();
                      },1000);
                  }
              }else if(moveId == 4){
                  // Ataque 4: Razor Leaf
                  this.showbottomright=false;
                  this.bottomText=`${this.bottomPoke} used ${this.pokemonSelecionado.abilities[3]}`;
                  this.oppoHP-=this.option4DMG;
                  // 160px health é considerado 100%
                  var newWidth = (this.oppoHP/250)*160;
                  this.playerAttack=true;
                  this.opponentShake=true;
                  setTimeout(()=>{
                      this.playerAttack=false;
                      this.opponentShake=false;
                  },1000);
                  this.oppoHpObj.width= newWidth + "px";
                  // Verifica se o oponente desmaiou
                  if (this.oppoHP < 0){
                    this.nextEnemy();
                  } else {
                      setTimeout(()=> {
                      this.showbottomright=true;
                          this.bottomText="";
                          this.currentTurn="opponent";
                          this.absolAttack();
                      },1000);                           
                  }
              }

          },
          
          // Função para executar o ataque do oponente (Absol)
          absolAttack: function(){
                  this.showbottomright=false;
                  this.bottomText="Absol attacked Venasaur with Jaden Smith tweet! deals 10000 damage but venasaur was reborn!";
                  this.userHP-=1;
                  // 160px health é considerado 100%
                  var newWidth = (this.userHP/300)*160;
                  this.oppoAttack=true;
                  this.playerShake=true;
                  setTimeout(()=>{
                      this.oppoAttack=false;
                      this.playerShake=false;
                  },500);
                  this.userHpObj.width= newWidth + "px";

                  setTimeout(()=> {
                      this.showbottomright=true;
                      this.bottomText="what are you going to do now?";
                  },1000);
                  this.currentTurn="player";

          },
          
          // Função para reiniciar as opções de batalha
          reinitialize: function(){
              this.option1="Fight";
              this.option2="Item";
              this.option3="Change Pokemon";
              this.option4="Run";
              this.backStatus=false;
              this.tooltipStatus=false;
              this.fightOptionStatus=true;
              this.bottomText="what are you going to do now?";
              this.playerShake=false;
              this.opponentShake=false;
          },
        //  next enemy
          nextEnemy: function(){
            if (teamEnemy.length > 0) {
                const nextEnemy = selectRandomEnemyPokemon();
                this.oppoPokemon = nextEnemy.gifImage;
                this.oppoHP = 250;
                this.oppoHpObj.width = "160px";
                this.bottomText = `The opponent sent out ${nextEnemy.name}!`;
                this.option1="Fight";
              this.option2="Item";
              this.option3="Pokemon";
              this.option4="Run";
              this.backStatus=false;
              this.tooltipStatus=false;
              this.fightOptionStatus=true;
              this.showbottomright=true;
              this.bottomPokeEnemy = nextEnemy.id +'. ' + nextEnemy.name

            } else {
                // Caso contrário, reinicie o jogo completamente
                setTimeout(()=> {
                    this.youWin()
                }, 2000);
            }
          },
          // Função para reiniciar o jogo
          restart: function(){
            this.victory = false
              this.userHP=300;
              this.userHpObj.width="160px";
              this.oppoHP=250;
              this.oppoHpObj.width="160px";
              this.option1="Fight";
              this.option2="Item";
              this.option3="Pokemon";
              this.option4="Run";
              this.backStatus=false;
              this.tooltipStatus=false;
              this.fightOptionStatus=true;
              this.bottomText="Absol fainted! match restarting";
                setTimeout(()=> {
                  this.showbottomright=true;
                  this.bottomText="";
                  this.pokemonSelecionado = null
              },2000);   
          },
          startBattle: function () {
                    // Verifique se o usuário selecionou um Pokémon
                    if (!this.pokemonSelecionado) {
                        // Exiba o aviso
                        var warningDiv = document.querySelector(".warning");
                        if (warningDiv) {
                            warningDiv.style.display = "block";
                        }
                    } else {
                        // Caso o Pokémon tenha sido selecionado, inicie a batalha normalmente
                        this.showbottomright = true;
                        this.bottomText = "";
                    }
                },
            youWin: function() {
                this.victory = true
            } 
      }
  })
  console.log(typeof <%- JSON.stringify(user.team[0].abilities[0]) %>)

  </script>


</body>

</html>